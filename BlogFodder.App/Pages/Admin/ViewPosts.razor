@page "/admin/viewposts"
@using BlogFodder.Core.Posts.Models
@using BlogFodder.Core.Data
@using Humanizer
@using Microsoft.EntityFrameworkCore
@layout AdminLayout
<PageTitle>View Posts</PageTitle>


<MudTable Items="@Posts" Hover="true" OnRowClick="RowClickEvent" T="Post">
    <HeaderContent>
        <MudTh>Title</MudTh>
        <MudTh>Date Updated</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Title">@context.Name</MudTd>
        <MudTd DataLabel="Date Updated">@context.DateUpdated.Humanize()</MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>


@code {
    
    [Inject] public BlogFodderDbContext DbContext { get; set; } = default!;
    [Inject] public NavigationManager NavigationManager { get; set; } = default!;

    public List<Post> Posts { get; set; } = new();

    protected override void OnInitialized()
    {
        Posts = DbContext.Posts.AsNoTracking().OrderByDescending(x => x.DateCreated).ToList();
    }
    
    private void RowClickEvent(TableRowClickEventArgs<Post> tableRowClickEventArgs)
    {
        NavigationManager.NavigateTo($"/admin/createpost/{tableRowClickEventArgs.Item.Id}");
    }

}