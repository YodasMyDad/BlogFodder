@using BlogFodder.Core.Posts.Models
@using Humanizer
@using BlogFodder.Core.Plugins.Interfaces
@using BlogFodder.Core.Plugins

<main class="container">

    <div class="row my-4 g-5">
        <div class="col-md-8">

            <article class="blog-post">
                <img class="img-fluid" src="@Post.FeaturedImage?.Url?width=900" alt="">
                <h1>@Post.Name</h1>
                <p>Last Updated: @Post.DateUpdated.Humanize()</p>
                @foreach (var postContentItem in Post.ContentItems)
                {
                    @* TODO - Margin and padding should be on the content items so can adjust per post/per content item *@
                    <div class="postContentItem my-4">
                        <DynamicComponent Type="@AvailableEditorPlugins[postContentItem.PluginAlias!].Content.Component"
                                          Parameters="@(new Dictionary<string, object> {{"Model", postContentItem.PluginData ?? ""}})"/>
                    </div>
                }
            </article>

        </div>

        <div class="col-md-4">
            <div class="position-sticky" style="top: 2rem;">
                <div class="p-4 mb-3 bg-light rounded">
                    <h4 class="fst-italic">About</h4>
                    <p class="mb-0">Customize this section to tell your visitors a little bit about your publication, writers, content, or something else entirely. Totally up to you.</p>
                </div>

                <div class="p-4">
                    <h4 class="fst-italic">Archives</h4>
                    <ol class="list-unstyled mb-0">
                        <li>
                            <a href="#">March 2021</a>
                        </li>
                        <li>
                            <a href="#">February 2021</a>
                        </li>
                        <li>
                            <a href="#">January 2021</a>
                        </li>
                        <li>
                            <a href="#">December 2020</a>
                        </li>
                        <li>
                            <a href="#">November 2020</a>
                        </li>
                        <li>
                            <a href="#">October 2020</a>
                        </li>
                        <li>
                            <a href="#">September 2020</a>
                        </li>
                        <li>
                            <a href="#">August 2020</a>
                        </li>
                        <li>
                            <a href="#">July 2020</a>
                        </li>
                        <li>
                            <a href="#">June 2020</a>
                        </li>
                        <li>
                            <a href="#">May 2020</a>
                        </li>
                        <li>
                            <a href="#">April 2020</a>
                        </li>
                    </ol>
                </div>

                <div class="p-4">
                    <h4 class="fst-italic">Elsewhere</h4>
                    <ol class="list-unstyled">
                        <li>
                            <a href="#">GitHub</a>
                        </li>
                        <li>
                            <a href="#">Twitter</a>
                        </li>
                        <li>
                            <a href="#">Facebook</a>
                        </li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

</main>

@code {

    [Inject]
    public ExtensionManager ExtensionManager { get; set; } = default!;

    private Dictionary<string, IEditorPlugin> AvailableEditorPlugins { get; set; } = new();

    [Parameter]
    public Post Post { get; set; } = default!;

    protected override void OnInitialized()
    {
        var editorPlugins = ExtensionManager.GetInstances<IEditorPlugin>(true);
        foreach (var plugin in editorPlugins)
        {
            AvailableEditorPlugins.Add(plugin.Value.Alias, plugin.Value);
        }
    }

}